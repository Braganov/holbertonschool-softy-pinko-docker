# filepath: /home/braga/holbertonschool-softy-pinko-docker/task6/proxy/proxy.conf
# Configuration du serveur Nginx pour agir comme proxy inverse avec équilibrage de charge
server {
    # Écoute sur le port 80 (HTTP standard)
    listen 80;
    # Nom du serveur configuré pour répondre à localhost
    server_name localhost;

    # Configuration pour rediriger les requêtes vers le front-end
    location / {
        # Redirige les requêtes vers le conteneur front-end sur le port 9000
        proxy_pass http://front-end:9000;
        # Transmet l'en-tête Host d'origine
        proxy_set_header Host $host;
        # Transmet l'adresse IP réelle du client
        proxy_set_header X-Real-IP $remote_addr;
    }

    # Configuration pour rediriger les requêtes API vers les instances back-end
    # L'équilibrage de charge est géré automatiquement par Docker en mode "scale"
    location /api {
        # Redirige les requêtes commençant par /api vers le service back-end
        # Docker gère l'équilibrage entre les instances multiples (Round Robin)
        proxy_pass http://back-end:5252;
        # Transmet l'en-tête Host d'origine
        proxy_set_header Host $host;
        # Transmet l'adresse IP réelle du client
        proxy_set_header X-Real-IP $remote_addr;
    }
}